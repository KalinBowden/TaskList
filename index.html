<html>
    <head>
        <!--
        Desc:   The main html page for the Electron app.
        Dev:    Kalin Bowden.
        Date: 11.29.2017.
        -->
        <title>My Task List</title>

        <!-- Soruces -->
        <!-- Compiled and minified CSS -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
        <link rel="stylesheet" href="styles.css">
        
    </head>
    <body>
        
         <nav>
            <div class="nav-wrapper">
            <a href="#!" class="brand-logo"><i class="material-icons">face</i>Mr BeDapper</a>
            <ul class="right">
                <li><a><i class="material-icons">cloud_download</i></a></li>
                <li><a><i class="material-icons" onclick="testMethod">backup</i></a></li>
                <li><a><i class="material-icons">refresh</i></a></li>
                <li><a><i class="material-icons" id="close">close</i></a></li>
            </ul>
            </div>
        </nav>

        <div class="row">

      <div class="col s1 sidebar">
        <a class="btn-floating btn-large waves-effect waves-light red"><i class="material-icons">account_circle</i></a>
        <a class="btn-floating btn-large waves-effect waves-light red" id="add"><i class="material-icons">add</i></a>
        <a class="btn-floating btn-large waves-effect waves-light red" id="clear"><i class="material-icons">delete_sweep</i></a>
        <a class="btn-floating btn-large waves-effect waves-light red"><i class="material-icons">hearing</i></a>
      </div>

      <div class="col s11">
        <ul class="collection" id="task">Your List is Empty</ul>
      </div>
    </div>
        



    <!-- Insert this line above script imports  -->
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

<!-- normal script imports etc  -->
<script src="scripts/jquery.min.js"></script>    
<script src="scripts/vendor.js"></script>
<script>require('./index.js')</script>

<!-- Insert this line after script imports -->
<script>if (window.module) module = window.module;</script>
<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <script>
        
        const electron = require('electron');
        const {ipcRenderer} = electron;
        const ul = document.querySelector('#task');

        responsiveVoice.speak("Hello Jordon. I am Mr BeDapper. Your personal assistant! How may I help you today", "UK English Male", {pitch: 1});

        var counter = 0;
        var startInterval = setInterval(_=>
        {
            counter += 0.02;
            document.querySelector('html').style.opacity = counter;
            document.querySelector('body').style.opacity = counter;
            document.querySelector('html').style.backgroundColor = 'rgba(152,251,152,'+counter/2+')';
        }, 100);

        

        //
        ipcRenderer.on('item:add', function(e, item)
        {
            console.log(ul.childNodes.length);
            if(ul.innerHTML === 'Your List is Empty')
            {
                ul.innerHTML = '';
            }

            console.log('the item was added');
            const li = document.createElement('li');
            li.classList.add('collection-item');
            li.classList.add('z-depth-5');
            li.classList.add('task');

            temp = item + '';
            console.log(temp + ' task');

            if (temp.nodeValue === '')
            {
                responsiveVoice.speak("Im sorry. But you can not add an empty task to your list!", "UK English Male", {pitch: 1});
            }

            responsiveVoice.speak("The task. "+item+". was added to your list!", "UK English Male", {pitch: 1});

            const itemText = document.createTextNode(item);
            
            li.innerHTML= createRow(itemText);
            ul.appendChild(li);
        })


        // Add task section
        function createRow(itemText)
        {
            var temp;
            temp = '<div class="row">' +
                        '<div class="col s6">'+itemText.nodeValue +'</div>' +
                        '<div class="col s1"></div>' +
                        '<div class="col s1"></div>' +
                        '<div class="col s4"></div>' +
                    '</div>'

            return temp;
        }


        //
        ipcRenderer.on('item:clear', function()
        {
            console.log('the list was cleared');
            
            ul.innerHTML = 'Your List is Empty';
            
        })


        // 
        ul.addEventListener('dblclick', removeItem)
        

        //
        function removeItem(e)
        {
            if(ul.innerHTML !== 'Your List is Empty')
            {
                e.target.remove();
            }
            
            
            if (ul.innerHTML === '')
            {
                ul.innerHTML = 'Your List is Empty';
            }
            
        }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
    </body>
</html>